---

lava-m:1:5:
  extends: .build
  variables:
    CC: gcc
  script:
    - ./M/build.sh
  artifacts:
    paths:
      - ./*/*/lava-gcc
  only:
    - dev
    - tags

lava-m:2:5:    
  extends: .build
  variables:
    CC: afl-gcc
  script:
    - ./M/build.sh
  artifacts:
    paths:
      - ./*/*/lava-afl-gcc

lava-m:3:5:    
  extends: .build
  script:
    - ./M/build.sh
  artifacts:
    paths:
      - ./*/*/lava-afl-cf

lava-m:4:5:
  extends: .build
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/i386/honggfuzz_runner:16.04
  script:
    - ./M/build.sh
  artifacts:
    paths:
      - ./*/*/lava-hf
  only:
    - tags

lava-m:5:5:
  extends: .build
  image:
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04
  script:
    - ./M/build.sh
  artifacts:
    paths:
      - ./*/*/lava-ang
  only:
    - tags

build:lava-m:
  extends: .test_seeds
  script:
    - echo "collecting artifacts"
  dependencies:
    - lava-m:1:5
    - lava-m:2:5
    - lava-m:3:5
    - lava-m:4:5
    - lava-m:5:5
  artifacts:
    paths:
      - ./*/*/lava-gcc
      - ./*/*/lava-afl-gcc
      - ./*/*/lava-afl-cf
      - ./*/*/lava-hf
      - ./*/*/lava-ang
    expire_in: 6 mos
  only:
    - dev
    - tags

