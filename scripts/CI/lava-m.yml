---

.build_lava_m:
  extends: .build
  before_script:
    - sudo apt-get -qq update
    - sudo apt-get -qq install -y libacl1-dev
  script:
    - echo "[*] building with CC=$CC"
    - ./0/build.sh
  only:
    - tags

lava-m:1:5:
  extends: .build_lava_m
  variables:
    CC: gcc
    PREFIX: "lava-gcc"

lava-m:2:5:    
  extends: .build_lava_m
  variables:
    CC: afl-gcc
    PREFIX: "lava-afl-gcc"

lava-m:3:5:    
  extends: .build_lava_m

lava-m:4:5:
  extends: .build_lava_m
  variables:
    PREFIX: "lava-hf"
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/i386/honggfuzz_runner:16.04

lava-m:5:5:
  extends: .build_lava_m
  variables:
    PREFIX: "lava-ang"
  image:
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04

build:lava-m:
  extends: .test_seeds
  script:
    - echo "collecting artifacts"
  dependencies:
    - lava-m:1:5
    - lava-m:2:5
    - lava-m:3:5
    - lava-m:4:5
    - lava-m:5:5
  artifacts:
    paths:
      - ./*/*/lava-gcc
      - ./*/*/lava-afl-gcc
      - ./*/*/lava-afl-cf
      - ./*/*/lava-hf
      - ./*/*/lava-ang
    expire_in: 6 mos
  only:
    - tags

test_solutions:1:5:lava-m:
  variables:
    COMP_ID: "0"
    PREFIX: "lava-gcc"
  extends: .test_solutions
  dependencies:
    - build:lava-m

test_solutions:2:5:lava-m:
  variables:
    COMP_ID: "0"
    PREFIX: "lava-afl-gcc"
  extends: .test_solutions
  dependencies:
    - build:lava-m

test_solutions:3:5:lava-m:
  variables:
    COMP_ID: "0"
    PREFIX: "lava-afl-cf"
  extends: .test_solutions
  dependencies:
    - build:lava-m

test_solutions:4:5:lava-m:
  variables:
    COMP_ID: "0"
    PREFIX: "lava-hf"
  extends: .test_solutions
  dependencies:
    - build:lava-m

test_solutions:5:5:lava-m:
  variables:
    COMP_ID: "0"
    PREFIX: "lava-ang"
  extends: .test_solutions
  dependencies:
    - build:lava-m
