---

build:angora:
  extends: .build
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04 
  script:
    - sed -i 's/ 10 / /' scripts/build.sh 
    - ./scripts/build.sh --angora -X
  artifacts:
    paths:
      - ./*/*/lava-ang
  only:
    - master

test_seeds:angora:
  extends: .test_seeds
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04 
  script:
    - sed -i 's/ 10 / /' scripts/build.sh 
    - ./scripts/build.sh --angora -X --copy-files
    - ./scripts/test-solution.py -p lava-ang 3/info.yaml
    - ./scripts/test-solution.py -p lava-ang 4/info.yaml
    - ./scripts/test-solution.py -p lava-ang 5/info.yaml
    - ./scripts/test-solution.py -p lava-ang 6/info.yaml
    - ./scripts/test-solution.py -p lava-ang 7/info.yaml
    - ./scripts/test-solution.py -p lava-ang 8/info.yaml
    - ./scripts/test-solution.py -p lava-ang 9/info.yaml
  dependencies:
    - build:angora
  only:
    - master

test_solutions:3:9:angora:
  extends: .test_solutions
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04 
  script:
    - ./scripts/build.sh --copy-files
    - tar -C 3 -xzf 3/solutions.tgz
    - ./scripts/test-solution.py -p lava-ang 3/info.yaml
  dependencies:
    - build:angora
  only:
    - master

test_solutions:4:9:angora:
  extends: .test_solutions
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04 
  script:
    - ./scripts/build.sh --copy-files
    - tar -C 4 -xzf 4/solutions.tgz
    - ./scripts/test-solution.py -p lava-ang 4/info.yaml
  dependencies:
    - build:angora
  only:
    - master

test_solutions:5:9:angora:
  extends: .test_solutions
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04 
  script:
    - ./scripts/build.sh --copy-files
    - tar -C 5 -xzf 5/solutions.tgz
    - ./scripts/test-solution.py -p lava-ang 5/info.yaml
  dependencies:
    - build:angora
  only:
    - master

test_solutions:6:9:angora:
  extends: .test_solutions
  image: 
    name: registry.gitlab.com/rode0day/fuzzer-testing/angora_runner:16.04 
  script:
    - ./scripts/build.sh --copy-files
    - tar -C 6 -xzf 6/solutions.tgz
    - (cd 6 && ./patch_solutions.sh )
    - ./scripts/test-solution.py -p lava-ang 6/info.yaml
  dependencies:
    - build:angora
  only:
    - master
